# AgentGateway Configuration
# See: https://agentgateway.dev/docs/
#
# This config exposes:
#   - Port 3000: LLM Gateway (OpenAI/Anthropic)
#   - Port 3001: MCP Server Gateway
#
# Set your API keys as Fly.io secrets:
#   fly secrets set OPENAI_API_KEY=sk-xxx ANTHROPIC_API_KEY=sk-ant-xxx

binds:
  # ===========================================
  # LLM Gateway - Port 3000
  # ===========================================
  - port: 3000
    listeners:
      - routes:
          - policies:
              cors:
                allowOrigins: ["*"]
                allowHeaders:
                  - content-type
                  - authorization
                  - anthropic-version
                  - x-api-key
            backends:
              - ai:
                  name: openai
                  provider:
                    openAI:
                      # model: gpt-4o  # Uncomment to force specific model
                  routes:
                    /v1/chat/completions: completions
                    /v1/models: passthrough
                    "*": passthrough
              - ai:
                  name: anthropic
                  provider:
                    anthropic:
                      # model: claude-sonnet-4-20250514  # Uncomment to force specific model
                  routes:
                    /v1/messages: messages
                    /anthropic/v1/messages: messages
                    "*": passthrough
            # Uncomment to enable backend auth (or use Fly secrets)
            # backendAuth:
            #   key: "$OPENAI_API_KEY"

  # ===========================================
  # MCP Server Gateway - Port 3001
  # ===========================================
  - port: 3001
    listeners:
      - routes:
          - policies:
              cors:
                allowOrigins: ["*"]
                allowHeaders:
                  - mcp-protocol-version
                  - content-type
                  - cache-control
            backends:
              - mcp:
                  targets:
                    - name: everything
                      stdio:
                        cmd: npx
                        args: ["@modelcontextprotocol/server-everything"]
